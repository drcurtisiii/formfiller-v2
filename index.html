<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Filler App (TFA) - Curtis Law Firm</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="logo-section">
                    <i class="fas fa-file-alt"></i>
                    <h1>Template Filler App</h1>
                    <span class="subtitle">Curtis Law Firm</span>
                </div>
                <div class="header-actions">
                    <button id="helpBtn" class="btn btn-outline">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                </div>
            </div>
        </header>

        <!-- Client/Matter Management Bar -->
        <div class="client-management-bar">
            <div class="client-controls">
                <div class="user-selector">
                    <label for="userSelect">User:</label>
                    <select id="userSelect" class="form-control">
                        <option value="">Select User...</option>
                        <option value="ray_curtis">Ray Curtis</option>
                        <option value="danielle_brown">Danielle Brown</option>
                        <option value="jessie_mangum">Jessie Mangum</option>
                        <option value="laurel_lavalle">Laurel Lavalle</option>
                        <option value="add_edit_user">+ Add/Edit User</option>
                    </select>
                </div>
                <button id="userSettingsBtn" class="btn btn-secondary" style="display: none;">
                    <i class="fas fa-user-cog"></i> User Settings
                </button>
                <div class="client-selector">
                    <label for="clientMatterSelect">Client/Matter:</label>
                    <select id="clientMatterSelect" class="form-control">
                        <option value="">Select Client/Matter...</option>
                        <option value="add-new">+ Add New Client/Matter</option>
                    </select>
                </div>
                <button id="addViewNotesBtn" class="btn btn-info" style="display: none;">
                    <i class="fas fa-sticky-note"></i> <span id="notesText">Add Notes</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Template Selection -->
            <section class="step-section active" id="step1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h2>Select Templates</h2>
                    <p>Choose one or more document templates from your cloud library</p>
                </div>
                
                <!-- Cloud Template Selector -->
                <div id="templateSelectorContainer">
                    <!-- Template selector will be loaded here -->
                </div>

                <div class="step-actions">
                    <button class="btn btn-primary" id="analyzeBtn" disabled>
                        <i class="fas fa-search"></i> Analyze Templates
                    </button>
                </div>
            </section>

            <!-- Step 2: Field Filling -->
            <section class="step-section" id="step2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h2>Fill Template Fields</h2>
                    <p>Enter information once - it will be applied to all templates</p>
                </div>

                <div class="field-categories" id="fieldCategories">
                    <!-- Dynamic field categories will be inserted here -->
                </div>

                <div class="step-actions">
                    <button class="btn btn-outline" id="backToStep1">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                    <button class="btn btn-primary" id="generateBtn">
                        <i class="fas fa-magic"></i> Generate Documents
                    </button>
                </div>
            </section>

            <!-- Step 3: Download Results -->
            <section class="step-section" id="step3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h2>Download Completed Documents</h2>
                    <p>Your filled templates are ready for download</p>
                </div>

                <div class="results-area" id="resultsArea">
                    <!-- Generated documents will appear here -->
                </div>

                <div class="step-actions">
                    <button class="btn btn-outline" id="startOver">
                        <i class="fas fa-refresh"></i> Start Over
                    </button>
                    <button class="btn btn-primary" id="downloadAll">
                        <i class="fas fa-download"></i> Download All
                    </button>
                </div>
            </section>
        </main>

        <!-- Loading Overlay -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3>Processing Templates...</h3>
                <p id="loadingMessage">Analyzing document fields...</p>
            </div>
        </div>

        <!-- Help Modal -->
        <div class="modal" id="helpModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>How to Use TFA</h3>
                    <button class="modal-close" id="closeHelp">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="help-section">
                        <h4>Step 1: Upload Templates</h4>
                        <p>Upload one or more Word documents (.docx) containing TFA field strings in the format:</p>
                        <code>{{CATEGORY.FIELD_NAME|TYPE|OPTIONS}}</code>
                    </div>
                    <div class="help-section">
                        <h4>Step 2: Fill Fields</h4>
                        <p>Enter your information once. The app will automatically detect all unique fields across your templates and organize them by category.</p>
                    </div>
                    <div class="help-section">
                        <h4>Step 3: Download</h4>
                        <p>Download your completed documents with all fields filled in correctly.</p>
                    </div>
                    <div class="help-section">
                        <h4>Supported Field Types</h4>
                        <ul>
                            <li><strong>TEXT:</strong> Regular text input</li>
                            <li><strong>SELECT:</strong> Dropdown with predefined options</li>
                            <li><strong>DATE:</strong> Date picker</li>
                            <li><strong>PHONE:</strong> Phone number formatting</li>
                            <li><strong>CALCULATED:</strong> Auto-calculated fields</li>
                            <li><strong>CONDITIONAL:</strong> Fields that depend on other values</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attorney Settings Modal -->
        <div class="modal" id="attorneyModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Attorney/Firm Settings</h3>
                    <span class="modal-close" id="attorneyModalClose">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="attorneyForm">
                        <div class="form-group">
                            <label for="firmName">Firm Name:</label>
                            <input type="text" id="firmName" class="form-control" value="The Curtis Law Firm, P.A.">
                        </div>
                        <div class="form-group">
                            <label for="attorneyName">Attorney Name:</label>
                            <input type="text" id="attorneyName" class="form-control" value="Ray Curtis">
                        </div>
                        <div class="form-group">
                            <label for="barNumber">Bar Number:</label>
                            <input type="text" id="barNumber" class="form-control" value="Fla. Bar No. 0043636">
                        </div>
                        <div class="form-group">
                            <label for="firmAddress">Address:</label>
                            <input type="text" id="firmAddress" class="form-control" value="103 N. Jefferson Street, Perry, FL 32347">
                        </div>
                        <div class="form-group">
                            <label for="firmPhone">Phone:</label>
                            <input type="text" id="firmPhone" class="form-control" value="(850) 584-5299">
                        </div>
                        <div class="form-group">
                            <label for="firmFax">Fax:</label>
                            <input type="text" id="firmFax" class="form-control" value="(850) 290-7448">
                        </div>
                        <div class="form-group">
                            <label for="firmEmail">Email:</label>
                            <input type="email" id="firmEmail" class="form-control" value="efile@thecurtislawfirm.com">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="attorneyModalCancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="attorneyModalSave">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- User Settings Modal -->
        <div class="modal" id="userModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="userModalTitle">User Settings</h3>
                    <span class="modal-close" id="userModalClose">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="userForm">
                        <div class="form-group">
                            <label for="userName">Full Name:</label>
                            <input type="text" id="userName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="userEmail">Email:</label>
                            <input type="email" id="userEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="userFirmName">Firm Name:</label>
                            <input type="text" id="userFirmName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="userBarNumber">Bar Number:</label>
                            <input type="text" id="userBarNumber" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="userFirmAddress">Firm Address:</label>
                            <textarea id="userFirmAddress" class="form-control" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="userFirmPhone">Phone:</label>
                            <input type="tel" id="userFirmPhone" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="userFirmFax">Fax:</label>
                            <input type="tel" id="userFirmFax" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="userTemplateFolder">Template Folder Path:</label>
                            <div class="folder-path-input">
                                <input type="text" id="userTemplateFolder" class="form-control" 
                                       placeholder="e.g., D:\Curtis Law Firm Dropbox\Templates\Criminal">
                                <button type="button" class="btn btn-outline" id="browseFolder">
                                    <i class="fas fa-folder-open"></i> Browse
                                </button>
                            </div>
                            <small class="help-text">Path to your Dropbox template folder</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="userModalCancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="userModalSave">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- GitHub Settings Modal -->
        <div class="modal" id="githubModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Cloud Storage Settings</h3>
                    <span class="modal-close" id="githubModalClose">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="github-config-section">
                        <div class="config-info">
                            <h4><i class="fab fa-github"></i> GitHub Repository Configuration</h4>
                            <p>Configure your private GitHub repository for secure data sharing between team members.</p>
                        </div>
                        
                        <form id="githubForm">
                            <div class="form-group">
                                <label for="githubRepo">Repository:</label>
                                <input type="text" id="githubRepo" class="form-control" placeholder="username/repository-name" value="drcurtisiii/formfiller">
                                <small class="help-text">Format: username/repository-name</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="githubToken">Personal Access Token:</label>
                                <input type="password" id="githubToken" class="form-control" placeholder="Enter your GitHub token">
                                <small class="help-text">Required for private repository access. <a href="https://github.com/settings/tokens" target="_blank">Create token</a></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="dataPath">Data Path:</label>
                                <input type="text" id="dataPath" class="form-control" value="data/" placeholder="data/">
                                <small class="help-text">Folder path in repository for storing data files</small>
                            </div>
                        </form>
                        
                        <div class="sync-status" id="syncStatus">
                            <div class="status-item">
                                <span class="status-label">Connection Status:</span>
                                <span class="status-value" id="connectionStatus">Not configured</span>
                            </div>
                            <div class="status-item">
                                <span class="status-label">Last Sync:</span>
                                <span class="status-value" id="lastSyncTime">Never</span>
                            </div>
                        </div>
                        
                        <div class="sync-actions">
                            <button type="button" class="btn btn-info" id="testConnectionBtn">
                                <i class="fas fa-link"></i> Test Connection
                            </button>
                            <button type="button" class="btn btn-warning" id="forceSyncBtn">
                                <i class="fas fa-sync"></i> Force Sync
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="githubModalCancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="githubModalSave">Save Settings</button>
                </div>
            </div>
        </div>

        <!-- Client/Matter Modal -->
        <div class="modal" id="clientMatterModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="clientMatterModalTitle">Add New Client/Matter</h3>
                    <span class="modal-close" id="clientMatterModalClose">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="clientMatterForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientFirstName">Client First Name:</label>
                                <input type="text" id="clientFirstName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label for="clientLastName">Client Last Name:</label>
                                <input type="text" id="clientLastName" class="form-control" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="matterDescription">Matter Description:</label>
                            <input type="text" id="matterDescription" class="form-control" placeholder="e.g., Divorce, Criminal Defense, etc." required>
                        </div>
                        <div class="form-group">
                            <label for="caseNumber">Case Number (Optional):</label>
                            <input type="text" id="caseNumber" class="form-control">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="clientMatterModalCancel">Cancel</button>
                    <button type="button" class="btn btn-primary" id="clientMatterModalSave">Save Client/Matter</button>
                </div>
            </div>
        </div>

        <!-- Notes Modal -->
        <div class="modal" id="notesModal">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3>Case Notes</h3>
                    <span class="modal-close" id="notesModalClose">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="notes-container">
                        <div class="existing-notes" id="existingNotes">
                            <!-- Existing notes will be populated here -->
                        </div>
                        <div class="add-note-section">
                            <h4>Add New Note</h4>
                            <textarea id="newNoteText" class="form-control" rows="4" placeholder="Enter your note here..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" id="notesModalCancel">Close</button>
                    <button type="button" class="btn btn-primary" id="addNoteBtn">Add Note</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="template-selector.js"></script>
    <script src="user-manager.js"></script>
    <script src="client-manager.js"></script>
    <script src="tfa-engine-api.js"></script>
    <script src="app.js"></script>
</body>
</html>
